<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>IoT-2021 Individual Assignments</title>
    <!-- Add some CSS to change client UI -->
    <style>
    body {
        background-color: #232F3E;
        }
    h1 {
 		text-align: center;
  		border: 3px solid green;
        color: #FF9900;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 40px;
        }
    h2 {
 		text-align: center;
        color: #FF9900;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 30px;
        }
    i {
    	color: #FFFFFF;
    }
    p, span {
        color: #FF9900;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 20px;
        margin-left: 40px;
        }
     input {
        color: #232F3E;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 20px;
        margin-left: 20px;
        }
    </style>
    <script>
        var callAPI = () =>{
            // instantiate a headers object
            var myHeaders = new Headers();
            // add content type header to object
            myHeaders.append("Content-Type", "application/json");
            // using built in JSON utility package turn object to string and store in a variable
            // var raw = JSON.stringify({"firstName":firstName,"lastName":lastName});
            // create a JSON object with parameters for API call and store in a variable
            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                //body: raw,
                redirect: 'follow'
            };
            // make API call with parameters and use promises to get response
            fetch("https://itixl6i4qe.execute-api.us-east-1.amazonaws.com/dev", requestOptions)
            .then(response => response.text())
            //.then(result => alert(JSON.parse(result).body))
            //{"statusCode": 200, "latest_lux": 22, "latest_temp": 24, "lux_max": 22, "lux_min": 22, "lux_avg": 22.0, "temp_max": 24, "temp_min": 24, "temp_avg": 24.0}
            //.then(result =>  document.getElementById("llux").innerHTML = JSON.parse(result).latest_lux)
            
            .then(function (result) {
            	document.getElementById("llux").innerHTML = JSON.parse(result).latest_lux;
            	document.getElementById("ltemp").innerHTML = JSON.parse(result).latest_temp;

            	document.getElementById("maxlux").innerHTML = JSON.parse(result).lux_max;
            	document.getElementById("minlux").innerHTML = JSON.parse(result).lux_min;
            	document.getElementById("avglux").innerHTML = JSON.parse(result).lux_avg;

            	document.getElementById("maxtemp").innerHTML = JSON.parse(result).temp_max;
            	document.getElementById("mintemp").innerHTML = JSON.parse(result).temp_min;
            	document.getElementById("avgtemp").innerHTML = JSON.parse(result).temp_avg; 

            	document.getElementById("alllux").innerHTML = JSON.parse(result).all_lux; 
            	document.getElementById("alltemp").innerHTML = JSON.parse(result).all_temp; 



            	var lamp = JSON.parse(result).lamp;
            	if (lamp === 1)
            		lamp = "ON";
            	else
            		lamp = "OFF";
				document.getElementById("curr_lamp").innerHTML = lamp;

				var led = JSON.parse(result).led;
				if (led === 0)
					led = "RED";
				else if (led === 1)
					led = "BLUE";
				else 
					led = "GREEN";
            	document.getElementById("curr_led").innerHTML = led; 



        	})

        	// LAMP: https://brh0jzg8hf.execute-api.us-east-1.amazonaws.com/dev
        	// LED: https://y2ig9vbgr4.execute-api.us-east-1.amazonaws.com/dev

            .catch(error => console.log('error', error));            
        }

        var triggerLamp = (code)=>{
            // instantiate a headers object
            //alert(code);
            var myHeaders = new Headers();
            // add content type header to object
            myHeaders.append("Content-Type", "application/json");
            // using built in JSON utility package turn object to string and store in a variable
            var raw = JSON.stringify({"lamp":code});
            // create a JSON object with parameters for API call and store in a variable
            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };
            // make API call with parameters and use promises to get response
            fetch("https://brh0jzg8hf.execute-api.us-east-1.amazonaws.com/dev", requestOptions)
            .then(response => response.text())
            .then(result => alert(JSON.parse(result).body))
            .catch(error => console.log('error', error));

            var lamp = "";
            if (code === 0)
            	lamp = "OFF";
            else 
            	lamp = "ON"
			document.getElementById("curr_lamp").innerHTML = lamp;

        } 

        var triggerLed = (code)=>{
            // instantiate a headers object
            //alert(code);
            var myHeaders = new Headers();
            // add content type header to object
            myHeaders.append("Content-Type", "application/json");
            // using built in JSON utility package turn object to string and store in a variable
            var raw = JSON.stringify({"led":code});
            // create a JSON object with parameters for API call and store in a variable
            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };
            // make API call with parameters and use promises to get response
            fetch("https://y2ig9vbgr4.execute-api.us-east-1.amazonaws.com/dev", requestOptions)
            .then(response => response.text())
            .then(result => alert(JSON.parse(result).body))
            .catch(error => console.log('error', error));

            var led = "";
			if (code === 0)
				led = "RED";
			else if (code === 1)
				led = "BLUE";
			else 
				led = "GREEN";    
            document.getElementById("curr_led").innerHTML = led; 
        
        }                 
    </script>
</head>
<body onload="callAPI()">
    <!--<form>
        <label>First Name :</label>
        <input type="text" id="fName">
        <label>Last Name :</label>
        <input type="text" id="lName">
        < !-- set button onClick method to call function we defined passing input values as parameters -- ">
        <button type="button" onclick="callAPI(document.getElementById('fName').value,document.getElementById('lName').value)">Call API</button>
    </form> -->

 	<h1> IoT 2021 Dashboard </h1>

 	<h2>Sensors' Readings</h2>
    <p>Latest sensor values:</p>  <p>Lux: <span></span></span><span id="llux"></span></p> <p>Temp: <span><span id="ltemp"></span></p>
    <hr>
    <p>Max, min, avg in the last hour:</p> <p>Lux: <span><span id="maxlux"></span> <span id="minlux"></span> <span id="avglux"></span></p>
    <p>Temp:<span> <span id="maxtemp"></span> <span id="mintemp"></span> <span id="avgtemp"></span></p>
    <hr>
    <p>Last hour readings (sorted from most recent to least recent):</p>
   
    <p>Lux:<span><span></span><span id="alllux"></span></p> 
    <p>Temp:<span><span></span><span id="alltemp"></span></p> 
    <hr>

 	<h2>Actuators' Triggers</h2>
 	<p>Lamp (status: <span id="curr_lamp"></span>)</p>
 	<p><button type="button" onclick="triggerLamp(1)">ON</button>  <button type="button" onclick="triggerLamp(0)">OFF</button>  </p>
  	<p>LED (status: <span id="curr_led"></span>)</p>
 	<p><button type="button" onclick="triggerLed(0)">R</button>  <button type="button" onclick="triggerLed(2)">G</button> 
 		<button type="button" onclick="triggerLed(1)">B</button> </p>

 	<i>Note1: If some values are "undefined", it means that all the readings in the database are older than 1 hour</i>
 	<p></p>
 	<i>Note2: Sorry for the way this dashboard looks, but it is my first time coding a website :).</i>
</body>
</html>
